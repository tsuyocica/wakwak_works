<div class="container mt-4">
  <div class="row">
    <div class="col-md-12 bg-light p-3 border-end">
      <h5 class="fw-bold">üí¨ „ÉÅ„É£„ÉÉ„Éà‰∏ÄË¶ß</h5>

      <table class="table table-hover table-bordered">
        <thead>
          <tr>
            <th>
              <%= link_to "‰ΩúÊ•≠‰ª∂Âêç", chats_path(sort: "work_title", order: params[:order] == "asc" ? "desc" : "asc"), class: "text-dark text-decoration-none" %>
              <%= params[:sort] == "work_title" ? (params[:order] == "asc" ? " ‚ñ≤" : " ‚ñº") : "" %>
            </th>
            <th>
              <%= link_to "ÊäïÁ®øËÄÖÂêç", chats_path(sort: "username", order: params[:order] == "asc" ? "desc" : "asc"), class: "text-dark text-decoration-none" %>
              <%= params[:sort] == "username" ? (params[:order] == "asc" ? " ‚ñ≤" : " ‚ñº") : "" %>
            </th>
            <th>
              <%= link_to "ÊôÇÈñì", chats_path(sort: "updated_at", order: params[:order] == "asc" ? "desc" : "asc"), class: "text-dark text-decoration-none" %>
              <%= params[:sort] == "updated_at" ? (params[:order] == "asc" ? " ‚ñ≤" : " ‚ñº") : "" %>
            </th>
          </tr>
        </thead>
        <tbody>
          <% if @chat_list.present? %>
            <% @chat_list.each do |chat| %>
              <% if current_user.role.include?("ÊñΩÂ∑•ÁÆ°ÁêÜËÄÖ") %>
                <% partner = chat.worker %> <!-- ÊñΩÂ∑•ÁÆ°ÁêÜËÄÖ„ÅØ‰ΩúÊ•≠Âì°„ÅÆÂêçÂâç„ÇíË°®Á§∫ -->
                <% chat_label = partner.username %>
                <% work_title = chat.job_post.work_title %> <!-- ‰ΩúÊ•≠‰ª∂Âêç„ÇíÂèñÂæó -->
              <% else %>
                <% partner = chat.owner %> <!-- ‰ΩúÊ•≠Âì°„ÅØÊ°à‰ª∂ÂêçÔºãÊñΩÂ∑•ÁÆ°ÁêÜËÄÖ„ÇíË°®Á§∫ -->
                <% chat_label = "#{chat.job_post.work_title} - #{partner.username}" %>
                <% work_title = chat.job_post.work_title %> <!-- ‰ΩúÊ•≠‰ª∂Âêç„ÇíÂèñÂæó -->
              <% end %>

              <% if partner.present? %>
                <tr class="clickable-row" data-href="<%= chat_path(chat) %>">
                  <!-- ‰ΩúÊ•≠‰ª∂Âêç -->
                  <td class="text-truncate" style="max-width: 200px;"><%= work_title %></td>

                  <!-- ÊäïÁ®øËÄÖÂêçÔºà„Ç¢„Éê„Çø„Éº‰ªò„ÅçÔºâ -->
                  <td class="d-flex align-items-center">
                    <div class="me-2">
                      <% if partner.avatar.attached? %>
                        <%= image_tag partner.avatar.variant(resize: "40x40"), class: "rounded-circle", alt: "Avatar", width: 40, height: 40 %>
                      <% else %>
                        <i class="bi bi-person-circle" style="font-size: 40px;"></i> <!-- „Éá„Éï„Ç©„É´„Éà„Ç¢„Ç§„Ç≥„É≥ -->
                      <% end %>
                    </div>
                    <div class="text-truncate"><%= chat_label %></div>
                  </td>

                  <!-- ÊäïÁ®øÊó•ÊôÇ -->
                  <td><span class="badge bg-secondary"><%= time_ago_in_words(chat.updated_at) %>Ââç</span></td>
                </tr>
              <% end %>
            <% end %>
          <% else %>
            <tr>
              <td colspan="3" class="text-center text-muted">„ÉÅ„É£„ÉÉ„Éà„Åå„ÅÇ„Çä„Åæ„Åõ„Çì</td>
            </tr>
          <% end %>
        </tbody>
      </table>
    </div>
  </div>
</div>

<!-- ‚úÖ Ë°å„Çí„ÇØ„É™„ÉÉ„ÇØ„Åô„Çã„Å®„ÉÅ„É£„ÉÉ„Éà„ÅÆ `show` „Å´ÈÅ∑Áßª„Åô„Çã„Çπ„ÇØ„É™„Éó„Éà -->
<script>
  document.addEventListener("DOMContentLoaded", function() {
    document.querySelectorAll(".clickable-row").forEach(row => {
      row.addEventListener("click", function() {
        window.location.href = this.dataset.href;
      });
    });
  });
</script>